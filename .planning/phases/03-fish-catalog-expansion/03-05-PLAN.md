---
phase: 03-fish-catalog-expansion
plan: 05
type: execute
wave: 5
depends_on: ["03-01", "03-04"]
files_modified:
  - fishing-app/sw.js
  - fishing-app/js/fish-ui.js
autonomous: false

must_haves:
  truths:
    - "Fish catalog loads and displays 200+ species in the grid"
    - "Tapping any fish shows complete detail with edibility stars, taste, texture, preparation"
    - "Tapping any fish shows habitat details (depth, region, structure)"
    - "Fish catalog works offline after initial load"
    - "Images lazy-load with IntersectionObserver for 200+ cards"
    - "Service worker cache version bumped to force update"
  artifacts:
    - path: "fishing-app/sw.js"
      provides: "Updated cache version v4"
      contains: "v4"
    - path: "fishing-app/js/fish-ui.js"
      provides: "Lazy loading with IntersectionObserver for fish grid images"
      contains: "IntersectionObserver"
  key_links:
    - from: "fishing-app/sw.js"
      to: "fishing-app/data/fish-data.json"
      via: "APP_SHELL caching"
      pattern: "fish-data.json"
    - from: "fishing-app/js/fish-ui.js"
      to: "IntersectionObserver"
      via: "Image lazy loading in renderFishList"
      pattern: "IntersectionObserver"
---

<objective>
Add image lazy loading for 200+ fish cards, bump service worker cache, and verify the complete fish catalog.

Purpose: Performance optimization for 200+ cards (lazy loading) and cache freshness (service worker bump). Final verification ensures all FISCH requirements are met end-to-end.
Output: Optimized fish grid with lazy loading, updated service worker, verified complete catalog.
</objective>

<execution_context>
@C:\Users\Lucas Benutzer\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Lucas Benutzer\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-fish-catalog-expansion/03-01-SUMMARY.md
@.planning/phases/03-fish-catalog-expansion/03-04-SUMMARY.md
@fishing-app/js/fish-ui.js
@fishing-app/sw.js
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add IntersectionObserver lazy loading for fish grid images and bump service worker</name>
  <files>fishing-app/js/fish-ui.js, fishing-app/sw.js</files>
  <action>
  1. In fish-ui.js, modify renderFishList to use lazy loading for fish card images:
     - Change the img element in card.innerHTML from `src="..."` to `data-src="..."` with a placeholder SVG as `src`:
       `src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='200' height='120'%3E%3Crect fill='%230d1b2a' width='200' height='120' rx='4'/%3E%3C/svg%3E"`
       (Dark background placeholder matching marine theme)
     - Add class "lazy" to the img element
     - Keep the existing `loading="lazy"` attribute as well (browser native lazy loading as fallback)
     - Keep the onerror handler but update it to work with data-src pattern

  2. After the grid is appended to the container in renderFishList, add IntersectionObserver setup:
     ```javascript
     var imageObserver = new IntersectionObserver(function(entries, observer) {
         entries.forEach(function(entry) {
             if (entry.isIntersecting) {
                 var img = entry.target;
                 if (img.dataset.src) {
                     img.src = img.dataset.src;
                     img.removeAttribute('data-src');
                     img.classList.remove('lazy');
                 }
                 observer.unobserve(img);
             }
         });
     }, {
         rootMargin: '100px 0px'
     });

     grid.querySelectorAll('img.lazy').forEach(function(img) {
         imageObserver.observe(img);
     });
     ```

  3. In sw.js, bump CACHE_VERSION from 'v3' to 'v4' to force cache refresh with new fish data.

  IMPORTANT: Maintain existing code style (var, string concatenation, function expressions). The IntersectionObserver code goes inside renderFishList, after `container.appendChild(grid)`.
  </action>
  <verify>
  Grep fish-ui.js for "IntersectionObserver" - should find the lazy loading setup.
  Grep fish-ui.js for "data-src" - should find the lazy image attribute.
  Grep sw.js for "v4" - should find the bumped cache version.
  </verify>
  <done>renderFishList uses IntersectionObserver to lazy-load fish card images with 100px rootMargin. Placeholder SVG shown until image enters viewport. Service worker cache bumped to v4.</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>Complete fish catalog with 200+ species, edibility/culinary information, habitat details, lazy loading for images, and offline caching.</what-built>
  <how-to-verify>
  1. Open fishing-app/index.html in a browser
  2. Navigate to the Fish tab/section
  3. Verify: Fish grid shows many fish cards (scroll to confirm 200+ are rendered)
  4. Verify: Scrolling loads images progressively (lazy loading working - images appear as you scroll)
  5. Tap on a fish card (e.g., Wolfsbarsch or Goldbrasse)
  6. Verify fish detail shows:
     - German name and Latin/scientific name
     - Image (or fallback SVG)
     - Baits listed as badges
     - Fishing techniques listed as badges
     - Season information
     - Closed season (if applicable)
     - "Kulinarische Eignung" section with:
       - Star rating (1-5 filled/empty stars)
       - Taste and texture info
       - Preparation method badges
       - Culinary notes (if present)
     - "Lebensraum-Details" section with:
       - Depth range
       - Region
       - Structure preferences as badges
  7. Navigate back to list, try another fish from a different category
  8. Optional: Test offline by going to DevTools > Network > Offline after initial load
  </how-to-verify>
  <resume-signal>Type "approved" if fish catalog looks good with all required details, or describe any issues you see.</resume-signal>
</task>

</tasks>

<verification>
1. Fish grid renders 200+ cards without performance issues
2. Lazy loading works (images load as user scrolls)
3. Fish detail shows all required information including edibility and habitat
4. Service worker cache is v4
5. App works offline with fish catalog accessible
</verification>

<success_criteria>
- FISCH-01: 200+ species visible in catalog
- FISCH-02: Each fish shows German name, Latin name, image
- FISCH-03: Each fish shows baits (type and recommendations)
- FISCH-04: Each fish shows fishing methods/techniques
- FISCH-05: Each fish shows season and closed season
- FISCH-06: Each fish shows habitat info (depth, water type, region, structure)
- FISCH-07: Each fish shows edibility rating, taste, preparation tips
- FISCH-08: Fish data embedded in app, works offline
</success_criteria>

<output>
After completion, create `.planning/phases/03-fish-catalog-expansion/03-05-SUMMARY.md`
</output>
