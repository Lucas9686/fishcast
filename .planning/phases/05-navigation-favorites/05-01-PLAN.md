---
phase: 05-navigation-favorites
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - fishing-app/index.html
  - fishing-app/js/config.js
  - fishing-app/js/app.js
  - fishing-app/css/style.css
autonomous: true

must_haves:
  truths:
    - "User sees exactly 3 tabs in bottom bar: Wetter, Fische, Favoriten"
    - "7-day forecast and catch breakdown are visible inside the Weather tab"
    - "User taps tab and URL hash updates (#weather, #fish, #favorites)"
    - "User loads app with #favorites in URL and lands on Favorites tab"
    - "Browser back button navigates between previously visited tabs"
  artifacts:
    - path: "fishing-app/index.html"
      provides: "3-tab navigation with forecast merged into weather section"
      contains: "tab-weather"
    - path: "fishing-app/js/app.js"
      provides: "Hash-based tab routing with hashchange listener"
      contains: "window.location.hash"
    - path: "fishing-app/js/config.js"
      provides: "SECTIONS and TABS constants without FORECAST entries"
  key_links:
    - from: "fishing-app/js/app.js"
      to: "window.location.hash"
      via: "switchTab updates hash, hashchange listener restores tab"
      pattern: "location\\.hash"
    - from: "fishing-app/js/app.js"
      to: "fishing-app/index.html"
      via: "switchTab references section IDs from CONFIG.SECTIONS"
      pattern: "CONFIG\\.SECTIONS"
---

<objective>
Consolidate from 4 tabs to 3 tabs (Weather, Fish, Favorites) by merging the Forecast section into the Weather tab, and add hash-based URL routing for bookmarkable tab state.

Purpose: UI-01 requires exactly 3 tabs. The 7-day forecast data is thematically part of weather and currently lives in a separate tab that fragments the UX. Hash routing enables bookmarking and back-button navigation.

Output: 3-tab bottom navigation with forecast content merged into weather section, URL hash reflects active tab.
</objective>

<execution_context>
@C:/Users/Lucas Benutzer/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/Lucas Benutzer/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-navigation-favorites/05-RESEARCH.md
@fishing-app/index.html
@fishing-app/js/config.js
@fishing-app/js/app.js
@fishing-app/css/style.css
</context>

<tasks>

<task type="auto">
  <name>Task 1: Merge Forecast section into Weather tab and reduce to 3 tabs</name>
  <files>fishing-app/index.html, fishing-app/js/config.js, fishing-app/css/style.css</files>
  <action>
**index.html changes:**

1. Move the ENTIRE `section-forecast` content (lines 227-268: the 7-day forecast card + catch breakdown card) INTO `section-weather`, placing it AFTER the hourly forecast card (after line 204's closing `</section>` tag but BEFORE the `</section>` close of section-weather). The two cards should be placed directly inside section-weather, NOT inside any wrapper.

2. REMOVE the now-empty `<section id="section-forecast">` element entirely.

3. In the tab bar nav (lines 298-333), REMOVE the entire forecast tab button (`<button id="tab-forecast"...>` through its closing `</button>`, lines 318-326).

4. Keep the remaining 3 tabs: tab-weather, tab-fish, tab-favorites (in that order).

**config.js changes:**

1. REMOVE `FORECAST: 'section-forecast'` from `CONFIG.SECTIONS` (line 110).
2. REMOVE `FORECAST: 'tab-forecast'` from `CONFIG.TABS` (line 118).
3. Keep only WEATHER, FISH, FAVORITES in both SECTIONS and TABS objects.

**style.css changes:**

No CSS changes needed - the `.tab-bar__tab` uses `flex: 1` so 3 tabs will automatically distribute evenly. The section and card styles are already generic.

**What to AVOID and WHY:**
- Do NOT change any IDs of the forecast containers (daily-forecast, forecast-catch-breakdown etc.) because app.js references them by ID for dynamic rendering.
- Do NOT remove the `section-forecast` CSS rules if any exist - they do no harm and may be used for print styles.
- Do NOT move the `<section>` tags, only move the CONTENT (cards) from forecast section into weather section.
  </action>
  <verify>
Open index.html in a text editor and verify:
1. Only 3 `tab-bar__tab` buttons exist (tab-weather, tab-fish, tab-favorites)
2. `section-forecast` element no longer exists
3. `daily-forecast` and `forecast-catch-breakdown` divs are now children of `section-weather`
4. CONFIG.SECTIONS has exactly 3 keys: WEATHER, FISH, FAVORITES
5. CONFIG.TABS has exactly 3 keys: WEATHER, FISH, FAVORITES

Run: `grep -c "tab-bar__tab" fishing-app/index.html` should return 3 button elements.
Run: `grep "section-forecast" fishing-app/index.html` should return 0 matches.
Run: `grep "FORECAST" fishing-app/js/config.js` should return 0 matches.
  </verify>
  <done>
index.html has exactly 3 tab buttons (Weather, Fish, Favorites). The 7-day forecast card and catch breakdown card are inside section-weather. section-forecast element is gone. CONFIG no longer references FORECAST.
  </done>
</task>

<task type="auto">
  <name>Task 2: Add hash-based URL routing to tab navigation</name>
  <files>fishing-app/js/app.js</files>
  <action>
**In app.js, modify the following:**

1. **Add hash routing constants** near the top of the IIFE (after the DOM References section, around line 26):

```javascript
// Hash routing maps
var HASH_TO_TAB = {
    '#weather': { tab: 'tab-weather', section: 'section-weather' },
    '#fish': { tab: 'tab-fish', section: 'section-fish' },
    '#favorites': { tab: 'tab-favorites', section: 'section-favorites' }
};
var SECTION_TO_HASH = {
    'section-weather': '#weather',
    'section-fish': '#fish',
    'section-favorites': '#favorites'
};
```

2. **Modify `switchTab()` function** to update the URL hash when switching tabs. Add this line at the END of the function body, BEFORE the favorites-refresh `if` block (before line 326):

```javascript
// Update URL hash for bookmarkability
var newHash = SECTION_TO_HASH[sectionId];
if (newHash && window.location.hash !== newHash) {
    history.pushState(null, '', newHash);
}
```

3. **Remove all references to FORECAST tab in switchTab and related code.** Search app.js for any `CONFIG.SECTIONS.FORECAST` or `CONFIG.TABS.FORECAST` references and remove them. The `renderCatchBreakdown()` function should remain as-is (it references DOM IDs directly, not section IDs).

4. **Add hashchange listener** inside the `init()` function, AFTER `setupTabs()` call (after line 190):

```javascript
// Hash-based routing: restore tab from URL on load
var initialRoute = HASH_TO_TAB[window.location.hash];
if (initialRoute) {
    switchTab(initialRoute.tab, initialRoute.section);
}

// Listen for browser back/forward navigation
window.addEventListener('hashchange', function() {
    var route = HASH_TO_TAB[window.location.hash];
    if (route) {
        // Avoid pushing duplicate history entry
        var currentSection = document.querySelector('.section.active');
        if (currentSection && currentSection.id !== route.section) {
            // Temporarily disable hash push in switchTab
            _suppressHashUpdate = true;
            switchTab(route.tab, route.section);
            _suppressHashUpdate = false;
        }
    }
});
```

5. **Add `_suppressHashUpdate` flag** near the hash routing constants:

```javascript
var _suppressHashUpdate = false;
```

6. **Wrap the hash update in switchTab** with the suppression check:

```javascript
if (!_suppressHashUpdate) {
    var newHash = SECTION_TO_HASH[sectionId];
    if (newHash && window.location.hash !== newHash) {
        history.pushState(null, '', newHash);
    }
}
```

**What to AVOID and WHY:**
- Do NOT use `window.location.hash = ...` directly because it always creates a history entry even when navigating back (causing infinite loop). Use `history.pushState` instead.
- Do NOT call switchTab inside hashchange without the suppress flag, or it will push a new history entry and break back-button.
- Do NOT remove `renderCatchBreakdown()` or any of its calls - it still renders into DOM IDs that are now inside the weather section.
  </action>
  <verify>
1. Open the app in a browser. Click each tab and verify the URL hash changes (#weather, #fish, #favorites).
2. Navigate to `index.html#favorites` directly - should open on Favorites tab.
3. Click Weather tab, then Fish tab, then Favorites tab. Press browser back button - should go back through Fish then Weather.
4. Verify no JavaScript errors in console during tab switching.
5. Verify the 7-day forecast and catch breakdown display correctly inside the Weather tab.

Run: `grep "HASH_TO_TAB\|SECTION_TO_HASH\|hashchange\|_suppressHashUpdate" fishing-app/js/app.js` should show all four patterns.
  </verify>
  <done>
Tab switches update the URL hash. Direct URL navigation to #fish or #favorites works. Browser back/forward buttons navigate between tabs without infinite loops. All existing weather content (including merged forecast) renders correctly.
  </done>
</task>

</tasks>

<verification>
1. Bottom tab bar shows exactly 3 tabs: Wetter, Fische, Favoriten
2. Weather tab contains: current weather, sun/moon, catch summary, hourly forecast, 7-day accordion, catch breakdown
3. URL updates on tab switch: #weather, #fish, #favorites
4. Direct URL access works (e.g., index.html#favorites opens favorites)
5. Back button navigates between previously visited tabs
6. No JavaScript console errors
7. All existing weather rendering functions still work (accordion, sparkline, tidal chart)
</verification>

<success_criteria>
- [ ] Only 3 tabs visible: Weather, Fish, Favorites
- [ ] 7-day forecast is inside the Weather section
- [ ] Catch breakdown is inside the Weather section
- [ ] URL hash reflects active tab
- [ ] Hash-based deep linking works
- [ ] Browser history navigation works
</success_criteria>

<output>
After completion, create `.planning/phases/05-navigation-favorites/05-01-SUMMARY.md`
</output>
