---
phase: 02-dark-marine-theme
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - fishing-app/css/style.css
  - fishing-app/index.html
autonomous: true

must_haves:
  truths:
    - "User opens app and sees dark marine theme with blue/turquoise accents on dark background"
    - "User sees no white flash or color flicker on page load in dark mode"
    - "User sees 'Petri Heil' branding in turquoise color"
    - "User with prefers-reduced-motion enabled sees no decorative animations"
  artifacts:
    - path: "fishing-app/css/style.css"
      provides: "Complete marine color palette, theme attribute selectors, wave background, card glow, tab pulse CSS, card fade-in CSS, accordion speed adjustment"
      contains: "data-theme"
    - path: "fishing-app/index.html"
      provides: "Anti-flicker inline script in head, theme toggle button in header"
      contains: "data-theme"
  key_links:
    - from: "fishing-app/index.html"
      to: "fishing-app/css/style.css"
      via: "data-theme attribute set by inline script, consumed by CSS attribute selectors"
      pattern: "data-theme"
---

<objective>
Retheme the entire app from forest-green to dark marine palette, implement CSS-based theme system with [data-theme] attribute selectors, add anti-flicker inline script, theme toggle button HTML, wave background animation, card glow effects, accordion speed adjustment, tab pulse animation, card fade-in classes, and comprehensive reduced-motion support.

Purpose: Establishes the visual foundation for the dark marine theme. After this plan, the app renders with the correct marine colors and all CSS animations/effects are in place. The theme toggle button exists in HTML but the JS toggle logic comes in Plan 02.

Output: Fully rethemed style.css with [data-theme="dark"] and [data-theme="light"] selectors, updated index.html with anti-flicker script and theme toggle button.
</objective>

<execution_context>
@C:\Users\Lucas Benutzer\.claude/get-shit-done/workflows/execute-plan.md
@C:\Users\Lucas Benutzer\.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-CONTEXT.md
@.planning/phases/02-dark-marine-theme/02-RESEARCH.md
@fishing-app/css/style.css
@fishing-app/index.html
</context>

<tasks>

<task type="auto">
  <name>Task 1: Retheme CSS custom properties and add theme attribute selectors</name>
  <files>fishing-app/css/style.css</files>
  <action>
Retheme the entire CSS file from forest-green to marine palette. This is the largest task.

**Step 1: Replace :root custom properties (lines 7-52)**

Replace ALL existing color variables with the marine palette. Keep layout variables unchanged:

```css
:root {
    /* Marine palette */
    --color-primary: #00bcd4;
    --color-primary-light: #26c6da;
    --color-primary-dark: #0097a7;
    --color-primary-surface: #1b263b;

    /* Accent: warm gold/amber (preserved from original) */
    --color-accent: #d4910a;
    --color-accent-light: #f5c842;

    /* Backgrounds (dark marine default) */
    --color-bg: #0d1b2a;
    --color-bg-card: #1b263b;
    --color-bg-elevated: #243447;
    --color-bg-overlay: rgba(0, 0, 0, 0.6);

    /* Text (high contrast for outdoor reading) */
    --color-text: #e0e0e0;
    --color-text-secondary: #a0b0c0;
    --color-text-muted: #808fa0;
    --color-text-inverse: #ffffff;

    /* Borders & Shadows */
    --color-border: rgba(0, 188, 212, 0.15);
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.4);
    --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.5);

    /* Glow effects */
    --glow-turquoise: rgba(0, 188, 212, 0.15);
    --glow-turquoise-strong: rgba(0, 188, 212, 0.25);
    --shadow-glow: 0 4px 16px var(--glow-turquoise);

    /* Catch ratings (unchanged) */
    --color-excellent: #22c55e;
    --color-good: #3b82f6;
    --color-moderate: #f59e0b;
    --color-poor: #ef4444;

    /* Layout (unchanged) */
    --top-bar-height: 96px;
    --tab-bar-height: 60px;
    --radius: 12px;
    --radius-sm: 8px;
    --touch-min: 44px;
    --content-padding: 12px;

    /* Safe area for notched phones */
    --safe-top: env(safe-area-inset-top, 0px);
    --safe-bottom: env(safe-area-inset-bottom, 0px);
}
```

**Step 2: Add [data-theme="light"] selector block**

Add AFTER :root and BEFORE the Reset section. This overrides the dark defaults for light mode:

```css
/* --- Marine Light Theme --- */
[data-theme="light"] {
    --color-primary: #00bcd4;
    --color-primary-light: #26c6da;
    --color-primary-dark: #0097a7;
    --color-primary-surface: #e0f7fa;

    --color-bg: #f0f4f8;
    --color-bg-card: #ffffff;
    --color-bg-elevated: #e8eef4;
    --color-bg-overlay: rgba(0, 0, 0, 0.45);

    --color-text: #1a1a1a;
    --color-text-secondary: #4a4a4a;
    --color-text-muted: #757575;
    --color-text-inverse: #ffffff;

    --color-border: #c0d0e0;
    --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.08);
    --shadow-md: 0 2px 8px rgba(0, 0, 0, 0.12);
    --shadow-lg: 0 4px 16px rgba(0, 0, 0, 0.15);

    --glow-turquoise: rgba(0, 188, 212, 0.08);
    --glow-turquoise-strong: rgba(0, 188, 212, 0.15);
    --shadow-glow: 0 4px 16px var(--glow-turquoise);
}
```

**Step 3: Replace the existing @media (prefers-color-scheme: dark) block (lines 2010-2043)**

DELETE the entire `@media (prefers-color-scheme: dark) { ... }` block at the bottom of the file. It is no longer needed because dark is the default in :root. The theme is now controlled via `[data-theme]` attributes, not media queries.

**Step 4: Update "Petri Heil" branding**

Find the `.top-bar__brand` selector (or add one) and set its color to turquoise:

```css
.top-bar__brand {
    color: var(--color-primary);
    font-weight: 700;
}
```

**Step 5: Update card styles for turquoise glow**

Modify the `.card` rule (around line 315) to use turquoise glow instead of green border:

```css
.card {
    background: var(--color-bg-card);
    border-radius: var(--radius);
    box-shadow: var(--shadow-sm), 0 0 0 1px var(--glow-turquoise), var(--shadow-glow);
    margin-bottom: 12px;
    overflow: hidden;
    border-left: 3px solid var(--color-primary-light);
    transition: box-shadow 0.3s ease, transform 0.2s ease, border-color 0.3s ease;
}

.card:hover {
    box-shadow: var(--shadow-md), 0 0 0 1px rgba(0, 188, 212, 0.2), 0 8px 24px var(--glow-turquoise-strong);
    transform: translateY(-2px);
    border-color: var(--color-primary);
}
```

**Step 6: Update tab-bar active indicator to turquoise**

The `.tab-bar__tab.active::before` already uses `var(--color-primary)` which is now turquoise. Verify `.tab-bar__tab.active` also uses it. Both icon and text should be turquoise for active tab.

**Step 7: Add theme toggle button styles**

Add a new `.btn-theme-toggle` class:

```css
/* --- Theme Toggle --- */
.btn-theme-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: var(--touch-min);
    height: var(--touch-min);
    border-radius: var(--radius-sm);
    font-size: 1.3rem;
    line-height: 1;
    transition: background 0.2s, transform 0.1s;
    -webkit-tap-highlight-color: transparent;
}

.btn-theme-toggle:hover {
    background: rgba(255, 255, 255, 0.15);
}

.btn-theme-toggle:active {
    transform: scale(0.9);
}
```

**Step 8: Add fish image dark mode border**

```css
[data-theme="dark"] .fish-card__image img,
:root .fish-card__image img {
    border-radius: var(--radius-sm);
    border: 1px solid rgba(0, 188, 212, 0.15);
}

[data-theme="light"] .fish-card__image img {
    border: none;
}
```

**Step 9: Update accordion hover glow**

Find `.daily-accordion__summary:hover` and add a subtle glow:

```css
.daily-accordion__summary:hover {
    background: var(--color-bg-elevated);
    box-shadow: inset 0 0 0 1px var(--glow-turquoise);
}
```

**Step 10: Update skeleton loading colors for dark theme**

Replace the hardcoded skeleton colors to use CSS variables. For the `.skeleton-text` and `.skeleton-card` rules, use:

```css
.skeleton-text {
    background: linear-gradient(90deg, var(--color-bg-elevated) 25%, var(--color-bg-card) 50%, var(--color-bg-elevated) 75%);
    /* ... rest stays the same */
}
```

Same for `.skeleton-card`.

**Step 11: Update `.daily-accordion__recommendation` background**

Replace hardcoded `#e8f5e9` or similar with `var(--color-primary-surface)`.

**Step 12: Add theme transition CSS**

Add a global transition rule for smooth theme switching. Place after the :root and [data-theme] blocks:

```css
/* --- Theme Transition --- */
html.theme-transition,
html.theme-transition *,
html.theme-transition *::before,
html.theme-transition *::after {
    transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease !important;
}
```

This class is added/removed by JS during theme toggle to enable the fade. It should NOT be present at page load (prevents flicker).

**Step 13: Update all component-specific dark mode overrides**

The fish category badges (.fish-card__category--raubfisch etc.) that were inside the `@media (prefers-color-scheme: dark)` block need to be moved to `[data-theme="dark"]` selectors OR made to work with the new variable system. Since dark is now the default, these dark-mode-specific rules should be the defaults, with light-mode overrides added where needed:

For the category badges, solunar badges, etc. - verify they use CSS variables. If they use hardcoded dark colors, those ARE now the defaults. Add `[data-theme="light"]` overrides for them with lighter backgrounds.

```css
/* Category badges - dark mode defaults */
.fish-card__category--raubfisch { background: #3b1c1c; color: #f87171; }
.fish-card__category--friedfisch { background: #1c2e3b; color: #60a5fa; }
.fish-card__category--salmonide { background: #3b2e1c; color: #fbbf24; }
.fish-card__category--salzwasser { background: #1c2e2e; color: #4dd0e1; }
.fish-card__category--meeresfruechte { background: #2e1c2e; color: #ce93d8; }

/* Light mode overrides */
[data-theme="light"] .fish-card__category--raubfisch { background: #fee2e2; color: #dc2626; }
[data-theme="light"] .fish-card__category--friedfisch { background: #dbeafe; color: #2563eb; }
[data-theme="light"] .fish-card__category--salmonide { background: #fef3c7; color: #d97706; }
[data-theme="light"] .fish-card__category--salzwasser { background: #cffafe; color: #0891b2; }
[data-theme="light"] .fish-card__category--meeresfruechte { background: #f3e8ff; color: #9333ea; }
```

Do the same pattern for `.solunar-period-badge--minor`, `.fish-detail__closed-season`, `.fish-badge--bait`, `.daily-accordion__recommendation`.
  </action>
  <verify>
Open fishing-app/css/style.css and verify:
1. :root contains marine palette variables (--color-bg: #0d1b2a, --color-primary: #00bcd4)
2. [data-theme="light"] block exists with light overrides
3. No @media (prefers-color-scheme: dark) block remains
4. --glow-turquoise and --shadow-glow variables exist
5. .card uses glow box-shadow
6. .btn-theme-toggle styles exist
7. Fish category badges have both dark defaults and [data-theme="light"] overrides
  </verify>
  <done>CSS file uses marine color palette with dark as default, [data-theme] attribute selectors for light/dark switching, turquoise glow on cards, turquoise branding, skeleton loading uses variables, all dark-mode-specific overrides migrated from media query to attribute selectors</done>
</task>

<task type="auto">
  <name>Task 2: Add wave background, accordion speed, tab pulse CSS, card fade-in CSS, and enhanced reduced-motion</name>
  <files>fishing-app/css/style.css</files>
  <action>
Add new CSS animations and effects. Append these in logical sections of the CSS file.

**Step 1: Add wave background animation**

Add BEFORE the Reduced Motion section (around line 1990). Place after body styles:

```css
/* --- Wave Background Animation --- */
body::before {
    content: '';
    position: fixed;
    top: 0;
    left: -50%;
    width: 200%;
    height: 100%;
    z-index: -1;
    background: linear-gradient(
        135deg,
        transparent 0%,
        var(--glow-turquoise) 25%,
        transparent 50%,
        rgba(0, 188, 212, 0.05) 75%,
        transparent 100%
    );
    animation: wave-drift 20s ease-in-out infinite;
    will-change: transform;
    pointer-events: none;
}

@keyframes wave-drift {
    0%, 100% {
        transform: translateX(0) translateY(0) rotate(0deg);
    }
    25% {
        transform: translateX(-10%) translateY(1%) rotate(0.5deg);
    }
    50% {
        transform: translateX(-20%) translateY(2%) rotate(0deg);
    }
    75% {
        transform: translateX(-10%) translateY(1%) rotate(-0.5deg);
    }
}

/* Subtle wave in light mode */
[data-theme="light"] body::before {
    background: linear-gradient(
        135deg,
        transparent 0%,
        rgba(0, 188, 212, 0.04) 25%,
        transparent 50%,
        rgba(0, 188, 212, 0.03) 75%,
        transparent 100%
    );
}
```

**Step 2: Adjust accordion animation speed**

Find `.daily-accordion__detail` (around line 833-836) and change `0.35s` to `0.25s`:

```css
.daily-accordion__detail {
    display: grid;
    grid-template-rows: 0fr;
    transition: grid-template-rows 0.25s ease;
}
```

Also update the chevron rotation transition to match (around line 812):

```css
.daily-accordion__chevron {
    /* ... existing styles ... */
    transition: transform 0.25s ease;
}
```

And the chevron ::before transition (around line 825):

```css
.daily-accordion__chevron::before {
    /* ... existing styles ... */
    transition: transform 0.25s ease;
}
```

**Step 3: Add tab pulse CSS animation**

Add near the tab-bar styles section:

```css
/* --- Tab Pulse Micro-Interaction --- */
@keyframes tab-pulse {
    0% {
        box-shadow: 0 0 0 0 rgba(0, 188, 212, 0.4);
    }
    50% {
        box-shadow: 0 0 0 8px rgba(0, 188, 212, 0);
    }
    100% {
        box-shadow: 0 0 0 0 rgba(0, 188, 212, 0);
    }
}

.tab-bar__tab.tab-pulse {
    animation: tab-pulse 0.4s ease-out;
}
```

**Step 4: Add card fade-in CSS**

Add near the card styles section:

```css
/* --- Card Fade-In on Scroll --- */
.card.fade-in-hidden {
    opacity: 0;
    transform: translateY(20px);
}

.card.fade-in-visible {
    opacity: 1;
    transform: translateY(0);
    transition: opacity 0.4s ease, transform 0.4s ease;
}
```

**Step 5: Enhance reduced-motion block**

Update the existing `@media (prefers-reduced-motion: reduce)` block to also cover the new animations:

```css
@media (prefers-reduced-motion: reduce) {
    *, *::before, *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    .section.active {
        animation: none;
        opacity: 1;
        transform: none;
    }
    /* Disable wave background animation */
    body::before {
        animation: none;
        opacity: 0.5;
    }
    /* Disable card hover lift */
    .card:hover {
        transform: none;
    }
    /* Disable tab pulse */
    .tab-bar__tab.tab-pulse {
        animation: none;
    }
    /* Disable card fade-in animation */
    .card.fade-in-hidden {
        opacity: 1;
        transform: none;
    }
    .card.fade-in-visible {
        transition: none;
    }
}
```

**Step 6: Update accordion reduced-motion block**

The existing accordion reduced-motion block (around line 1057-1064) should also use 0.25s references. Since the global `*` rule handles it with `transition-duration: 0.01ms !important`, the specific accordion reduced-motion block can remain or be simplified.
  </action>
  <verify>
Open fishing-app/css/style.css and verify:
1. body::before contains wave-drift animation with will-change: transform
2. @keyframes wave-drift exists with translateX/translateY keyframes
3. .daily-accordion__detail transition is 0.25s (not 0.35s)
4. @keyframes tab-pulse exists
5. .tab-bar__tab.tab-pulse class exists
6. .card.fade-in-hidden and .card.fade-in-visible classes exist
7. @media (prefers-reduced-motion: reduce) covers body::before, tab-pulse, and card fade-in
  </verify>
  <done>Wave background animates subtly, accordion opens/closes at 0.25s, tab pulse CSS animation ready for JS trigger, card fade-in classes ready for Intersection Observer, all new animations disabled under prefers-reduced-motion</done>
</task>

<task type="auto">
  <name>Task 3: Add anti-flicker inline script and theme toggle button to HTML</name>
  <files>fishing-app/index.html</files>
  <action>
Modify index.html to add the anti-flicker theme script and the theme toggle button.

**Step 1: Add anti-flicker inline script in `<head>`**

Add BEFORE the `<link rel="stylesheet" href="css/style.css">` line (currently line 24). This script must execute synchronously before CSS loads:

```html
    <!-- Theme: anti-flicker (must run before CSS) -->
    <script>
      (function() {
        var stored = localStorage.getItem('theme');
        var theme = stored || 'auto';
        if (theme === 'auto') {
          var prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
          document.documentElement.setAttribute('data-theme', prefersDark ? 'dark' : 'light');
        } else {
          document.documentElement.setAttribute('data-theme', theme);
        }
      })();
    </script>
```

Also update `<meta name="theme-color" content="#1a5e2a">` to `<meta name="theme-color" content="#0d1b2a">` (dark marine blue).

**Step 2: Add theme toggle button in header**

In the top-bar header, add a theme toggle button NEXT TO the existing map toggle button (btn-map-toggle). Add it AFTER the map toggle button, inside the `.location-bar` div:

```html
                <button id="btn-theme-toggle" class="btn-icon btn-theme-toggle" aria-label="Theme wechseln" title="Theme wechseln">
                    ðŸ”„
                </button>
```

The icon starts as the auto icon (ðŸ”„). JavaScript in Plan 02 will update it based on current theme state.

**Step 3: Verify script load order**

Ensure the inline theme script is BEFORE the CSS link. The existing script tags at the bottom (with defer) are fine -- they load after DOM is ready.

No need to add a new JS file to the script list since the ThemeToggle logic will be added to app.js in Plan 02.
  </action>
  <verify>
Open fishing-app/index.html and verify:
1. Inline script exists in `<head>` BEFORE the CSS link
2. Script reads localStorage and sets data-theme on documentElement
3. meta theme-color content is "#0d1b2a"
4. Theme toggle button with id="btn-theme-toggle" exists in the header
5. Button has aria-label="Theme wechseln"
6. Script does NOT use defer (must be synchronous)
  </verify>
  <done>Anti-flicker script prevents white flash on dark mode load, theme toggle button visible in header next to map button, meta theme-color updated to dark marine blue</done>
</task>

</tasks>

<verification>
After all 3 tasks complete:
1. Open fishing-app/index.html in browser -- app should display with dark marine blue background (#0d1b2a), turquoise accents, no green remnants
2. "Petri Heil" header text should be turquoise
3. Cards should have subtle turquoise glow border/shadow
4. Subtle wave background should animate slowly
5. Accordion should open/close at 0.25s speed (noticeably snappier than before)
6. Theme toggle button should be visible in header (non-functional until Plan 02 JS)
7. No flash of white/green on page load
8. Set OS to light mode -- app should show light marine theme
9. Enable Reduced Motion in OS settings -- all decorative animations should stop
10. All 44px touch targets maintained
</verification>

<success_criteria>
- Dark marine palette renders correctly (no forest-green remnants in any component)
- Anti-flicker script prevents FOUC on dark mode
- [data-theme] attribute system replaces @media (prefers-color-scheme: dark) entirely
- Wave background visible and smooth (no scroll jank)
- Card glow effects visible on dark background
- Accordion speed is 0.25s
- Tab pulse and card fade-in CSS classes are defined (JS wiring in Plan 02)
- prefers-reduced-motion disables ALL decorative animations
- Light mode shows same turquoise/gold accents on light background
</success_criteria>

<output>
After completion, create `.planning/phases/02-dark-marine-theme/02-01-SUMMARY.md`
</output>
